language: go
sudo: false
matrix:
  include:
    - go: 1.x

before_install:
  - go get github.com/mitchellh/gox

install:
  - # skip

script:
  - go get -t -v ./...
  - diff -u <(echo -n) <(gofmt -d .)
  - go vet $(go list ./... | grep -v /vendor/)
  - go test -v -race ./...
  - if [ "${LATEST}" = "true" ]; then gox -os="linux darwin windows" -arch="amd64" -output="subs-rename.." -ldflags "-X main.Rev=`git rev-parse --short HEAD`" -verbose ./...; fi

deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: "PzrYMwR8qFmnBEkFdp6L15KSHQaOhWWcclUM68k/FHdkPrgy+1t61jCqa2AEkY2IXExVz4pZ2Rebd62Vy5Vkku1vJW3602V8Hk2JnTjh4ZZYMzUAb3YFrwfSkA5qiWTGAxXIusmgo3+Hm9pFGMY07gbQCyxuRui6sKGMmtEAdu/LA4oYZZH8z1sHbr+y2WmVlOeYwBFeTl9UO9zyT2m8lKSL7uCsmzX5rtXztkk21rHgLYCxpMp+QNIsSrhnB5+ceU5W1QrK8+GiOnXDJEnW405Gj7mt4AtgAggG6wxKNDi2FEQB+PJcJ5W8xFJtRpBhMspugkjA5pi1zj8Zg2UMTarN/pTUo2R+beh+mZeRhALroSc0dRXXm0UJk8VVmEUjqq+vjHaXboE43O68Sjhr4gmD+CeQ58p+GRhhXquXqkPbBDerLZf0TMnK4V1lAbOuBePYN5PKPuU9+PCAfY8k24Y2lRJ2hq43fvBVxqA2OwD4FQRiRrsotSlQ9sLOR26CQdzmi0yImvfVmwDbPxMmGhkYDdwPMuLlJxklWTALSlI7GFQQk8nfLG3eeUYqRbkuFnKByswvC625bj6VY/HcV1sOXEEgh6CxpJckxQ8ij0f1+2S5WhtUAixV9Qp/fPAbO08EKveke1bGu4vH8QUIBvARUtDIooiKYYve+xiuAyw="
    
  file:
    - subs-rename.windows.amd64.exe
    - subs-rename.darwin.amd64
    - subs-rename.linux.amd64
  on:
    repo: choppu/subs-rename
    tags: true
    condition: $LATEST = true